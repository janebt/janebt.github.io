<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">


    <link rel="dns-prefetch" href="https://cdn1.lncld.net"/>













    <!-- Title -->
    
    <title>
        
            《阮一峰--Redux 入门教程》笔记 | 
        
        Jane&#39;s blog
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="jane">
    <meta name="description" itemprop="description" content="Redux 入门教程学习笔记。
这篇文章讲的很好，配合官网文可以快速入门。">
    <meta name="keywords" content="jane, blog, hexo, Web, 博客,Redux">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.jpeg">
    <link rel="icon" sizes="192x192" href="/img/favicon.jpeg">
    <link rel="apple-touch-icon" href="/img/favicon.jpeg">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Jane&#39;s blog">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    
        
            <link rel=alternate type="application/atom+xml" href="atom.xml">
        
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-image: url(http://t1.aixinxi.net/o_1c1dbeee6lmkhc81k2c44n1joba.png-w.jpg);
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <style>
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 300;
            src: local('Roboto Light'), local('Roboto-Light'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Light.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Light.woff') format('woff');
        }
        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 300;
            src: local('Roboto LightItalic'), local('Roboto-LightItalic'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-LightItalic.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-LightItalic.woff') format('woff');
          }
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            src: local('Roboto Regular'), local('Roboto-Regular'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Regular.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Regular.woff') format('woff');
        }
        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 400;
            src: local('Roboto RegularItalic'), local('Roboto-RegularItalic'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-RegularItalic.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-RegularItalic.woff') format('woff');
          }
        @font-face {
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 500;
            src: local('Roboto Medium'), local('Roboto-Medium'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Medium.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-Medium.woff') format('woff');
        }
        @font-face {
            font-family: 'Roboto';
            font-style: italic;
            font-weight: 500;
            src: local('Roboto MediumItalic'), local('Roboto-MediumItalic'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-MediumItalic.woff2') format('woff2'), url('https://cdnjs.cat.net/ajax/libs/mdui/0.2.1/fonts/roboto/Roboto-MediumItalic.woff') format('woff');
        }
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: local('Material Icons'),
            local('MaterialIcons-Regular'),
            url(https://cdnjs.cat.net/ajax/libs/material-design-icons/3.0.1/iconfont/MaterialIcons-Regular.woff2) format('woff2'),
            url(https://cdnjs.cat.net/ajax/libs/material-design-icons/3.0.1/iconfont/MaterialIcons-Regular.woff) format('woff'),
            url(https://cdnjs.cat.net/ajax/libs/material-design-icons/3.0.1/iconfont/MaterialIcons-Regular.ttf) format('truetype');
        }
    </style>


<!-- Import Material Icon -->

    <link rel="stylesheet" href="https://cdn.bootcss.com/material-design-icons/3.0.1/iconfont/material-icons.min.css">




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","https://cdn.bootcss.com/jquery/2.2.0/jquery.js", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://janebt.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="《阮一峰--Redux 入门教程》笔记 | Jane&#39;s blog">
    <meta property="og:image" content="http://janebt.github.io/img/favicon.jpeg" />
    <meta property="og:description" content="Redux 入门教程学习笔记。
这篇文章讲的很好，配合官网文可以快速入门。">
    <meta property="og:article:tag" content="Redux"> 

    
        <meta property="article:published_time" content="Wed Jan 10 2018 10:35:34 GMT+0800" />
        <meta property="article:modified_time" content="Wed Jan 10 2018 10:35:34 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="《阮一峰--Redux 入门教程》笔记 | Jane&#39;s blog">
    <meta name="twitter:description" content="Redux 入门教程学习笔记。
这篇文章讲的很好，配合官网文可以快速入门。">
    <meta name="twitter:image" content="http://janebt.github.io/img/favicon.jpeg">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://janebt.github.io" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://janebt.github.io/2018/01/10/前端/框架/React/《阮一峰--Redux 入门教程》笔记/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://janebt.github.io/2018/01/10/前端/框架/React/《阮一峰--Redux 入门教程》笔记/index.html",
    "headline": "《阮一峰--Redux 入门教程》笔记",
    "datePublished": "Wed Jan 10 2018 10:35:34 GMT+0800",
    "dateModified": "Wed Jan 10 2018 10:35:34 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "jane",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.jpg"
        },
        "description": ""
    },
    "publisher": {
        "@type": "Organization",
        "name": "Jane&#39;s blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.jpeg"
        }
    },
    "keywords": ",Reduxjane, blog, hexo, Web, 博客",
    "description": "Redux 入门教程学习笔记。
这篇文章讲的很好，配合官网文可以快速入门。",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#《阮一峰–Redux-入门教程》笔记"><span class="post-toc-number">1.</span> <span class="post-toc-text">《阮一峰–Redux 入门教程》笔记</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#我的问题"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">我的问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#中间件"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">中间件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#reducer"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">reducer</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#state"><span class="post-toc-number">1.1.3.</span> <span class="post-toc-text">state</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Redux-入门教程"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Redux 入门教程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#基本用法"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">基本用法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#零、你可能不需要-Redux"><span class="post-toc-number">1.2.1.1.</span> <span class="post-toc-text">零、你可能不需要 Redux</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#一、预备知识"><span class="post-toc-number">1.2.1.2.</span> <span class="post-toc-text">一、预备知识</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#二、设计思想"><span class="post-toc-number">1.2.1.3.</span> <span class="post-toc-text">二、设计思想</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#三、基本概念和-API"><span class="post-toc-number">1.2.1.4.</span> <span class="post-toc-text">三、基本概念和 API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-1-Store"><span class="post-toc-number">1.2.1.4.1.</span> <span class="post-toc-text">3.1 Store</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-State"><span class="post-toc-number">1.2.1.4.2.</span> <span class="post-toc-text">3.2 State</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-3-Action"><span class="post-toc-number">1.2.1.4.3.</span> <span class="post-toc-text">3.3 Action</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-4-Action-Creator"><span class="post-toc-number">1.2.1.4.4.</span> <span class="post-toc-text">3.4 Action Creator</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-5-store-dispatch"><span class="post-toc-number">1.2.1.4.5.</span> <span class="post-toc-text">3.5 store.dispatch()</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-6-Reducer"><span class="post-toc-number">1.2.1.4.6.</span> <span class="post-toc-text">3.6 Reducer</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-7-纯函数"><span class="post-toc-number">1.2.1.4.7.</span> <span class="post-toc-text">3.7 纯函数</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-8-store-subscribe"><span class="post-toc-number">1.2.1.4.8.</span> <span class="post-toc-text">3.8 store.subscribe()</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#四、Store-的实现"><span class="post-toc-number">1.2.1.5.</span> <span class="post-toc-text">四、Store 的实现</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#五、Reducer-的拆分"><span class="post-toc-number">1.2.1.6.</span> <span class="post-toc-text">五、Reducer 的拆分</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#六、工作流程"><span class="post-toc-number">1.2.1.7.</span> <span class="post-toc-text">六、工作流程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#七、实例：计数器"><span class="post-toc-number">1.2.1.8.</span> <span class="post-toc-text">七、实例：计数器</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#中间件与异步操作"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">中间件与异步操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#一、中间件的概念"><span class="post-toc-number">1.2.2.1.</span> <span class="post-toc-text">一、中间件的概念</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#二、中间件的用法"><span class="post-toc-number">1.2.2.2.</span> <span class="post-toc-text">二、中间件的用法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#三、applyMiddleware"><span class="post-toc-number">1.2.2.3.</span> <span class="post-toc-text">三、applyMiddleware()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#四、异步操作的基本思路"><span class="post-toc-number">1.2.2.4.</span> <span class="post-toc-text">四、异步操作的基本思路</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#五、redux-thunk-中间件"><span class="post-toc-number">1.2.2.5.</span> <span class="post-toc-text">五、redux-thunk 中间件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#六、redux-promise-中间件"><span class="post-toc-number">1.2.2.6.</span> <span class="post-toc-text">六、redux-promise 中间件</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#React-Redux-的用法"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">React-Redux 的用法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#一、UI-组件"><span class="post-toc-number">1.2.3.1.</span> <span class="post-toc-text">一、UI 组件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#二、容器组件"><span class="post-toc-number">1.2.3.2.</span> <span class="post-toc-text">二、容器组件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#三、connect"><span class="post-toc-number">1.2.3.3.</span> <span class="post-toc-text">三、connect()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#四、mapStateToProps"><span class="post-toc-number">1.2.3.4.</span> <span class="post-toc-text">四、mapStateToProps()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#五、mapDispatchToProps"><span class="post-toc-number">1.2.3.5.</span> <span class="post-toc-text">五、mapDispatchToProps()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#六、-lt-Provider-gt-组件"><span class="post-toc-number">1.2.3.6.</span> <span class="post-toc-text">六、<Provider> 组件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#七、实例：计数器-1"><span class="post-toc-number">1.2.3.7.</span> <span class="post-toc-text">七、实例：计数器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#八、React-Router-路由库"><span class="post-toc-number">1.2.3.8.</span> <span class="post-toc-text">八、React-Router 路由库</span></a></li></ol></li></ol></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 1 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                《阮一峰--Redux 入门教程》笔记
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>jane</strong>
        <span>1月 10, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Redux/">Redux</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    <!-- Leancloud Views -->
        <a class="post_share-link" href="#">
            <li class="mdl-menu__item">
                <span id="/2018/01/10/前端/框架/React/《阮一峰--Redux 入门教程》笔记/" class="leancloud-views_num" data-flag-title="《阮一峰--Redux 入门教程》笔记">
     &nbsp;浏览量
</span>

            </li>
        </a>
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=《阮一峰--Redux 入门教程》笔记&url=http://janebt.github.io/2018/01/10/前端/框架/React/《阮一峰--Redux 入门教程》笔记/index.html&pic=http://janebt.github.io/img/favicon.jpeg&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>Redux 入门教程学习笔记。</p>
<p>这篇文章讲的很好，配合官网文可以快速入门。</p>
<a id="more"></a>
<h1 id="《阮一峰–Redux-入门教程》笔记"><a href="#《阮一峰–Redux-入门教程》笔记" class="headerlink" title="《阮一峰–Redux 入门教程》笔记"></a>《阮一峰–Redux 入门教程》笔记</h1><h2 id="我的问题"><a href="#我的问题" class="headerlink" title="我的问题"></a>我的问题</h2><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>只是为为异步吗？那为什么不直接使用promise呢做thunk呢？使用细节呢</p>
<h3 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h3><p>reducer的颗粒度才是最好</p>
<h3 id="state"><a href="#state" class="headerlink" title="state"></a>state</h3><p>哪些state应该扔到store里，跨层多次使用就扔吗</p>
<hr>
<h2 id="Redux-入门教程"><a href="#Redux-入门教程" class="headerlink" title="Redux 入门教程"></a>Redux 入门教程</h2><blockquote>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="external">阮一峰–Redux 入门教程</a></p>
<p>关于中间件部分不理解</p>
</blockquote>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p>有两个方面，它没涉及。</p>
<blockquote>
<ul>
<li>代码结构</li>
<li>组件之间的通信</li>
</ul>
</blockquote>
<h4 id="零、你可能不需要-Redux"><a href="#零、你可能不需要-Redux" class="headerlink" title="零、你可能不需要 Redux"></a>零、你可能不需要 Redux</h4><p>Redux 的适用场景：多交互、多数据源。</p>
<blockquote>
<ul>
<li>用户的使用方式复杂</li>
<li>不同身份的用户有不同的使用方式（比如普通用户和管理员）</li>
<li>多个用户之间可以协作</li>
<li>与服务器大量交互，或者使用了WebSocket</li>
<li>View要从多个来源获取数据</li>
</ul>
</blockquote>
<p>从组件角度看：</p>
<blockquote>
<ul>
<li>某个组件的状态，需要共享</li>
<li>某个状态需要在任何地方都可以拿到</li>
<li>一个组件需要改变全局状态</li>
<li>一个组件需要改变另一个组件的状态</li>
</ul>
</blockquote>
<h4 id="一、预备知识"><a href="#一、预备知识" class="headerlink" title="一、预备知识"></a>一、预备知识</h4><p>React + Flux + <a href="http://redux.js.org/" target="_blank" rel="external">文档</a> + 小视频（<a href="https://egghead.io/courses/getting-started-with-redux" target="_blank" rel="external">前30集</a>，<a href="https://egghead.io/courses/building-react-applications-with-idiomatic-redux" target="_blank" rel="external">后30集</a>）</p>
<h4 id="二、设计思想"><a href="#二、设计思想" class="headerlink" title="二、设计思想"></a>二、设计思想</h4><blockquote>
<p>（1）Web 应用是一个状态机，视图与状态是一一对应的。</p>
<p>（2）所有的状态，保存在一个对象里面。</p>
</blockquote>
<h4 id="三、基本概念和-API"><a href="#三、基本概念和-API" class="headerlink" title="三、基本概念和 API"></a>三、基本概念和 API</h4><h5 id="3-1-Store"><a href="#3-1-Store" class="headerlink" title="3.1 Store"></a>3.1 Store</h5><p>整个应用只能有一个 Store。</p>
<p>Redux 提供<code>createStore</code>这个函数，用来生成 Store。</p>
<pre><code class="react">import { createStore } from &#39;redux&#39;;
const store = createStore(fn);
</code></pre>
<h5 id="3-2-State"><a href="#3-2-State" class="headerlink" title="3.2 State"></a>3.2 State</h5><p>如果想得到某个时点的数据，就要对 Store 生成快照。这种时点的数据集合，就叫做 State。可以通过<code>store.getState()</code>拿到。</p>
<pre><code class="react">import { createStore } from &#39;redux&#39;;
const store = createStore(fn);

const state = store.getState();
</code></pre>
<p>Redux 规定， 一个 State 对应一个 View。只要 State 相同，View 就相同。</p>
<h5 id="3-3-Action"><a href="#3-3-Action" class="headerlink" title="3.3 Action"></a>3.3 Action</h5><p>State 的变化必须是 View 导致的。Action 就是 View 发出的通知，表示 State 应该要发生变化了。</p>
<p>Action 是一个对象。其中的<code>type</code>属性是必须的，表示 Action 的名称。其他属性可以自由设置</p>
<pre><code class="react">const action = {
  type: &#39;ADD_TODO&#39;,
  payload: &#39;Learn Redux&#39;
};
</code></pre>
<p>可以这样理解，Action 描述当前发生的事情。改变 State 的唯一办法，就是使用 Action。它会运送数据到 Store。</p>
<h5 id="3-4-Action-Creator"><a href="#3-4-Action-Creator" class="headerlink" title="3.4 Action Creator"></a>3.4 Action Creator</h5><p>View 要发送多少种消息，就会有多少种 Action。可以定义一个函数来生成 Action，这个函数就叫 Action Creator。</p>
<pre><code class="react">const ADD_TODO = &#39;添加 TODO&#39;;

function addTodo(text) {
  return {
    type: ADD_TODO,
    text
  }
}

const action = addTodo(&#39;Learn Redux&#39;);
</code></pre>
<p><code>addTodo</code>函数就是一个 Action Creator。</p>
<h5 id="3-5-store-dispatch"><a href="#3-5-store-dispatch" class="headerlink" title="3.5 store.dispatch()"></a>3.5 store.dispatch()</h5><p><code>store.dispatch()</code>是 View 发出 Action 的唯一方法。</p>
<pre><code class="react">store.dispatch({
  type: &#39;ADD_TODO&#39;,
  payload: &#39;Learn Redux&#39;
});
</code></pre>
<p><code>store.dispatch</code>接受一个 Action 对象作为参数，将它发送出去。</p>
<p>结合 Action Creator，这段代码可以改写如下。</p>
<pre><code class="react">store.dispatch(addTodo(&#39;Learn Redux&#39;));
</code></pre>
<h5 id="3-6-Reducer"><a href="#3-6-Reducer" class="headerlink" title="3.6 Reducer"></a>3.6 Reducer</h5><p>Store 收到 Action 以后，必须给出一个新的 State，这样 View 才会发生变化。这种 State 的计算过程就叫做 Reducer。</p>
<p>Reducer 是一个函数，它接受 Action 和当前 State 作为参数，返回一个新的 State。</p>
<pre><code class="react">const reducer = function (state, action) {
  // ...
  return new_state;
};
</code></pre>
<p><code>store.dispatch</code>方法会触发 Reducer 的自动执行。为此，Store 需要知道 Reducer 函数，做法就是在生成 Store 的时候，将 Reducer 传入<code>createStore</code>方法。</p>
<pre><code class="react">import { createStore } from &#39;redux&#39;;
const store = createStore(reducer);
</code></pre>
<p>为什么这个函数叫做 Reducer 呢？因为它可以作为数组的<code>reduce</code>方法的参数。</p>
<h5 id="3-7-纯函数"><a href="#3-7-纯函数" class="headerlink" title="3.7 纯函数"></a>3.7 纯函数</h5><p>Reducer 函数最重要的特征是，它是一个纯函数。也就是说，只要是同样的输入，必定得到同样的输出。</p>
<p>纯函数是函数式编程的概念，必须遵守以下一些约束。</p>
<blockquote>
<ul>
<li>不得改写参数</li>
<li>不能调用系统 I/O 的API</li>
<li>不能调用<code>Date.now()</code>或者<code>Math.random()</code>等不纯的方法，因为每次会得到不一样的结果</li>
</ul>
</blockquote>
<p>由于 Reducer 是纯函数，就可以保证同样的State，必定得到同样的 View。但也正因为这一点，Reducer 函数里面不能改变 State，必须返回一个全新的对象，请参考下面的写法。</p>
<pre><code class="react">// State 是一个对象
function reducer(state, action) {
  return Object.assign({}, state, { thingToChange });
  // 或者
  return { ...state, ...newState };
}

// State 是一个数组
function reducer(state, action) {
  return [...state, newItem];
}
</code></pre>
<p>最好把 State 对象设成只读。这样的好处是，任何时候，与某个 View 对应的 State 总是一个不变的对象。</p>
<h5 id="3-8-store-subscribe"><a href="#3-8-store-subscribe" class="headerlink" title="3.8 store.subscribe()"></a>3.8 store.subscribe()</h5><p>Store 允许使用<code>store.subscribe</code>方法设置监听函数，一旦 State 发生变化，就自动执行这个函数。</p>
<pre><code class="react">import { createStore } from &#39;redux&#39;;
const store = createStore(reducer);

store.subscribe(listener);
</code></pre>
<p>显然，只要把 View 的更新函数（对于 React 项目，就是组件的<code>render</code>方法或<code>setState</code>方法）放入<code>listen</code>，就会实现 View 的自动渲染。</p>
<p><code>store.subscribe</code>方法返回一个函数，调用这个函数就可以解除监听。</p>
<pre><code class="react">let unsubscribe = store.subscribe(() =&gt;
  console.log(store.getState())
);

unsubscribe();
</code></pre>
<h4 id="四、Store-的实现"><a href="#四、Store-的实现" class="headerlink" title="四、Store 的实现"></a>四、Store 的实现</h4><p>可以发现 Store 提供了三个方法。</p>
<ul>
<li>store.getState()</li>
<li>store.dispatch()</li>
<li>store.subscribe()</li>
</ul>
<pre><code class="react">import { createStore } from &#39;redux&#39;;
let { subscribe, dispatch, getState } = createStore(reducer);
</code></pre>
<p><code>createStore</code>方法还可以接受第二个参数，表示 State 的最初状态。这通常是服务器给出的。</p>
<pre><code class="react">let store = createStore(todoApp, window.STATE_FROM_SERVER)
</code></pre>
<p>注意，如果提供了这个参数，它会覆盖 Reducer 函数的默认初始值。</p>
<p><code>createStore</code>方法的一个简单实现</p>
<pre><code class="react">const createStore = (reducer) =&gt; {
  let state;
  let listeners = [];

  const getState = () =&gt; state;

  const dispatch = (action) =&gt; {
    state = reducer(state, action);
    listeners.forEach(listener =&gt; listener());
  };

  const subscribe = (listener) =&gt; {
    listeners.push(listener);
    return () =&gt; {
      listeners = listeners.filter(l =&gt; l !== listener);
    }
  };

  dispatch({});

  return { getState, dispatch, subscribe };
};
</code></pre>
<h4 id="五、Reducer-的拆分"><a href="#五、Reducer-的拆分" class="headerlink" title="五、Reducer 的拆分"></a>五、Reducer 的拆分</h4><p>Reducer 函数负责生成 State。由于整个应用只有一个 State 对象，包含所有数据，导致 Reducer 函数也十分庞大。</p>
<pre><code class="react">const chatReducer = (state = defaultState, action = {}) =&gt; {
  return {
    chatLog: chatLog(state.chatLog, action),
    statusMessage: statusMessage(state.statusMessage, action),
    userName: userName(state.userName, action)
  }
};
</code></pre>
<p>这样一拆，Reducer 就易读易写多了。而且，这种拆分与 React 应用的结构相吻合：一个 React 根组件由很多子组件构成。这就是说，子组件与子 Reducer 完全可以对应。</p>
<p>Redux 提供了一个<code>combineReducers</code>方法，用于 Reducer 的拆分合成。</p>
<pre><code class="react">import { combineReducers } from &#39;redux&#39;;

const chatReducer = combineReducers({
  chatLog,
  statusMessage,
  userName
})

export default todoApp;
</code></pre>
<p>这种写法有一个前提，就是 State 的属性名必须与子 Reducer 同名。如果不同名，就要采用下面的写法。</p>
<pre><code class="react">const reducer = combineReducers({
  a: doSomethingWithA,
  b: processB,
  c: c
})
</code></pre>
<p>可以把所有子 Reducer 放在一个文件里面，然后统一引入。</p>
<pre><code class="react">import { combineReducers } from &#39;redux&#39;
import * as reducers from &#39;./reducers&#39;

const reducer = combineReducers(reducers)
</code></pre>
<h4 id="六、工作流程"><a href="#六、工作流程" class="headerlink" title="六、工作流程"></a>六、工作流程</h4><p><img src="http://www.ruanyifeng.com/blogimg/asset/2016/bg2016091802.jpg" alt=""></p>
<p>首先，用户发出 Action。</p>
<pre><code class="react">store.dispatch(action);
</code></pre>
<p>Store 自动调用 Reducer，并且传入两个参数：当前 State 和收到的 Action。Reducer 会返回新的 State</p>
<pre><code class="react">let nextState = todoApp(previousState, action);
</code></pre>
<p>State 一旦有变化，Store 就会调用监听函数。</p>
<pre><code class="react">store.subscribe(listener);
</code></pre>
<p><code>listener</code>可以通过<code>store.getState()</code>得到当前状态。如果使用的是 React，这时可以触发重新渲染 View。</p>
<pre><code class="react">function listerner() {
  let newState = store.getState();
  component.setState(newState);   
}
</code></pre>
<h4 id="七、实例：计数器"><a href="#七、实例：计数器" class="headerlink" title="七、实例：计数器"></a>七、实例：计数器</h4><h3 id="中间件与异步操作"><a href="#中间件与异步操作" class="headerlink" title="中间件与异步操作"></a>中间件与异步操作</h3><p>Action 发出以后，Reducer 立即算出 State，这叫做同步；Action 发出以后，过一段时间再执行 Reducer，这就是异步。</p>
<p>怎么才能 Reducer 在异步操作结束后自动执行呢？这就要用到新的工具：中间件（middleware）。</p>
<h4 id="一、中间件的概念"><a href="#一、中间件的概念" class="headerlink" title="一、中间件的概念"></a>一、中间件的概念</h4><p>如果要添加功能，你会在哪个环节添加？</p>
<blockquote>
<p>（1）Reducer：纯函数，只承担计算 State 的功能，不合适承担其他功能，也承担不了，因为理论上，纯函数不能进行读写操作。</p>
<p>（2）View：与 State 一一对应，可以看作 State 的视觉层，也不合适承担其他功能。</p>
<p>（3）Action：存放数据的对象，即消息的载体，只能被别人操作，自己不能进行任何操作。</p>
</blockquote>
<p>中间件就是一个函数，对<code>store.dispatch</code>方法进行了改造，在发出 Action 和执行 Reducer 这两步之间，添加了其他功能。</p>
<p>Case. <code>store.dispatch</code>进行了重定义，在发送 Action 前后添加了打印功能。</p>
<h4 id="二、中间件的用法"><a href="#二、中间件的用法" class="headerlink" title="二、中间件的用法"></a>二、中间件的用法</h4><p>常用的中间件都有现成的，只要引用别人写好的模块即可。介绍怎么使用中间件。</p>
<pre><code class="react">import { applyMiddleware, createStore } from &#39;redux&#39;;
import createLogger from &#39;redux-logger&#39;;
const logger = createLogger();

const store = createStore(
  reducer,
  applyMiddleware(logger)
);
</code></pre>
<p>有两点需要注意：</p>
<p>（1）<code>createStore</code>方法可以接受整个应用的初始状态作为参数，那样的话，<code>applyMiddleware</code>就是第三个参数了。</p>
<pre><code class="react">const store = createStore(
  reducer,
  initial_state,
  applyMiddleware(logger)
);
</code></pre>
<p>（2）中间件的次序有讲究。</p>
<pre><code class="react">const store = createStore(
  reducer,
  applyMiddleware(thunk, promise, logger)
);
</code></pre>
<p>比如，<code>logger</code>就一定要放在最后，否则输出结果会不正确。</p>
<h4 id="三、applyMiddleware"><a href="#三、applyMiddleware" class="headerlink" title="三、applyMiddleware()"></a>三、applyMiddleware()</h4><p>它是 Redux 的原生方法，作用是将所有中间件组成一个数组，依次执行。下面是它的源码。</p>
<pre><code class="react">export default function applyMiddleware(...middlewares) {
  return (createStore) =&gt; (reducer, preloadedState, enhancer) =&gt; {
    var store = createStore(reducer, preloadedState, enhancer);
    var dispatch = store.dispatch;
    var chain = [];

    var middlewareAPI = {
      getState: store.getState,
      dispatch: (action) =&gt; dispatch(action)
    };
    chain = middlewares.map(middleware =&gt; middleware(middlewareAPI));
    dispatch = compose(...chain)(store.dispatch);

    return {...store, dispatch}
  }
}
</code></pre>
<p>上面代码中，所有中间件被放进了一个数组<code>chain</code>，然后嵌套执行，最后执行<code>store.dispatch</code>。可以看到，中间件内部（<code>middlewareAPI</code>）可以拿到<code>getState</code>和<code>dispatch</code>这两个方法。</p>
<h4 id="四、异步操作的基本思路"><a href="#四、异步操作的基本思路" class="headerlink" title="四、异步操作的基本思路"></a>四、异步操作的基本思路</h4><p>同步操作只要发出一种 Action 即可，异步操作的差别是它要发出三种 Action。</p>
<ul>
<li>操作发起时的 Action</li>
<li>操作成功时的 Action</li>
<li>操作失败时的 Action</li>
</ul>
<p>以向服务器取出数据为例，三种 Action 可以有两种不同的写法。</p>
<pre><code>// 写法一：名称相同，参数不同
{ type: &#39;FETCH_POSTS&#39; }
{ type: &#39;FETCH_POSTS&#39;, status: &#39;error&#39;, error: &#39;Oops&#39; }
{ type: &#39;FETCH_POSTS&#39;, status: &#39;success&#39;, response: { ... } }

// 写法二：名称不同
{ type: &#39;FETCH_POSTS_REQUEST&#39; }
{ type: &#39;FETCH_POSTS_FAILURE&#39;, error: &#39;Oops&#39; }
{ type: &#39;FETCH_POSTS_SUCCESS&#39;, response: { ... } }
</code></pre><p>除了 Action 种类不同，异步操作的 State 也要进行改造，反映不同的操作状态。</p>
<pre><code class="react">let state = {
  // ... 
  isFetching: true,
  didInvalidate: true,
  lastUpdated: &#39;xxxxxxx&#39;
};
</code></pre>
<h4 id="五、redux-thunk-中间件"><a href="#五、redux-thunk-中间件" class="headerlink" title="五、redux-thunk 中间件"></a>五、redux-thunk 中间件</h4><p>异步操作至少要送出两个 Action：用户触发第一个 Action，这个跟同步操作一样，没有问题；如何才能在操作结束时，系统自动送出第二个 Action 呢？</p>
<p>奥妙就在 Action Creator 之中。Action Creator（动作生成器）的例子：</p>
<pre><code class="react">const fetchPosts = postTitle =&gt; (dispatch, getState) =&gt; {
  dispatch(requestPosts(postTitle));
  return fetch(`/some/API/${postTitle}.json`)
    .then(response =&gt; response.json())
    .then(json =&gt; dispatch(receivePosts(postTitle, json)));
  };
};

// 使用方法一
store.dispatch(fetchPosts(&#39;reactjs&#39;));
// 使用方法二
store.dispatch(fetchPosts(&#39;reactjs&#39;)).then(() =&gt;
  console.log(store.getState())
);
</code></pre>
<p><code>fetchPosts</code>是一个Action Creator（动作生成器），返回一个函数。这个函数执行后，先发出一个Action（<code>requestPosts(postTitle)</code>），然后进行异步操作。拿到结果后，先将结果转成 JSON 格式，然后再发出一个 Action（ <code>receivePosts(postTitle, json)</code>）。</p>
<p>有几个地方需要注意。</p>
<blockquote>
<p>（1）<code>fetchPosts</code>返回了一个函数，而普通的 Action Creator 默认返回一个对象。</p>
<p>（2）返回的函数的参数是<code>dispatch</code>和<code>getState</code>这两个 Redux 方法，普通的 Action Creator 的参数是 Action 的内容。</p>
<p>（3）在返回的函数之中，先发出一个 Action（<code>requestPosts(postTitle)</code>），表示操作开始。</p>
<p>（4）异步操作结束之后，再发出一个 Action（<code>receivePosts(postTitle, json)</code>），表示操作结束。</p>
</blockquote>
<p>这样的处理，就解决了自动发送第二个 Action 的问题。但是，又带来了一个新的问题，Action 是由<code>store.dispatch</code>方法发送的。而<code>store.dispatch</code>方法正常情况下，参数只能是对象，不能是函数。这时，就要使用中间件<a href="https://github.com/gaearon/redux-thunk" target="_blank" rel="external"><code>redux-thunk</code></a>。</p>
<pre><code class="react">import { createStore, applyMiddleware } from &#39;redux&#39;;
import thunk from &#39;redux-thunk&#39;;
import reducer from &#39;./reducers&#39;;

// Note: this API requires redux@&gt;=3.1.0
const store = createStore(
  reducer,
  applyMiddleware(thunk)
);
</code></pre>
<p>上面代码使用<code>redux-thunk</code>中间件，改造<code>store.dispatch</code>，使得后者可以接受函数作为参数。</p>
<p>因此，异步操作的第一种解决方案就是，写出一个返回函数的 Action Creator，然后使用<code>redux-thunk</code>中间件改造<code>store.dispatch</code>。</p>
<h4 id="六、redux-promise-中间件"><a href="#六、redux-promise-中间件" class="headerlink" title="六、redux-promise 中间件"></a>六、redux-promise 中间件</h4><p>另一种异步操作的解决方案，就是让 Action Creator 返回一个 Promise 对象。这就需要使用<code>redux-promise</code>中间件。</p>
<pre><code class="react">import { createStore, applyMiddleware } from &#39;redux&#39;;
import promiseMiddleware from &#39;redux-promise&#39;;
import reducer from &#39;./reducers&#39;;

const store = createStore(
  reducer,
  applyMiddleware(promiseMiddleware)
);
</code></pre>
<p>这个中间件使得<code>store.dispatch</code>方法可以接受 Promise 对象作为参数。这时，Action Creator 有两种写法。写法一，返回值是一个 Promise 对象。</p>
<pre><code class="react">const fetchPosts = 
  (dispatch, postTitle) =&gt; new Promise(function (resolve, reject) {
     dispatch(requestPosts(postTitle));
     return fetch(`/some/API/${postTitle}.json`)
       .then(response =&gt; {
         type: &#39;FETCH_POSTS&#39;,
         payload: response.json()
       });
});
</code></pre>
<p>写法二，Action 对象的<code>payload</code>属性是一个 Promise 对象。这需要从<a href="https://github.com/acdlite/redux-actions" target="_blank" rel="external"><code>redux-actions</code></a>模块引入<code>createAction</code>方法，并且写法也要变成下面这样。</p>
<pre><code class="react">import { createAction } from &#39;redux-actions&#39;;

class AsyncApp extends Component {
  componentDidMount() {
    const { dispatch, selectedPost } = this.props
    // 发出同步 Action
    dispatch(requestPosts(selectedPost));
    // 发出异步 Action
    dispatch(createAction(
      &#39;FETCH_POSTS&#39;, 
      fetch(`/some/API/${postTitle}.json`)
        .then(response =&gt; response.json())
    ));
  }
</code></pre>
<p>上面代码中，第二个<code>dispatch</code>方法发出的是异步 Action，只有等到操作结束，这个 Action 才会实际发出。注意，<code>createAction</code>的第二个参数必须是一个 Promise 对象。</p>
<p><code>redux-promise</code>的<a href="https://github.com/acdlite/redux-promise/blob/master/src/index.js" target="_blank" rel="external">源码</a></p>
<pre><code class="react">export default function promiseMiddleware({ dispatch }) {
  return next =&gt; action =&gt; {
    if (!isFSA(action)) {
      return isPromise(action)
        ? action.then(dispatch)
        : next(action);
    }

    return isPromise(action.payload)
      ? action.payload.then(
          result =&gt; dispatch({ ...action, payload: result }),
          error =&gt; {
            dispatch({ ...action, payload: error, error: true });
            return Promise.reject(error);
          }
        )
      : next(action);
  };
}
</code></pre>
<p>从上面代码可以看出，如果 Action 本身是一个 Promise，它 resolve 以后的值应该是一个 Action 对象，会被<code>dispatch</code>方法送出（<code>action.then(dispatch)</code>），但 reject 以后不会有任何动作；如果 Action 对象的<code>payload</code>属性是一个 Promise 对象，那么无论 resolve 和 reject，<code>dispatch</code>方法都会发出 Action。</p>
<h3 id="React-Redux-的用法"><a href="#React-Redux-的用法" class="headerlink" title="React-Redux 的用法"></a>React-Redux 的用法</h3><blockquote>
<p>为了方便使用，Redux 的作者封装了一个 React 专用的库 <a href="https://github.com/reactjs/react-redux" target="_blank" rel="external">React-Redux</a>这个库是可以选用的。实际项目中，你应该权衡一下，是直接使用 Redux，还是使用 React-Redux。</p>
</blockquote>
<h4 id="一、UI-组件"><a href="#一、UI-组件" class="headerlink" title="一、UI 组件"></a>一、UI 组件</h4><p>React-Redux 将所有组件分成两大类：UI 组件（presentational component）和容器组件（container component）。</p>
<p>UI 组件有以下几个特征。</p>
<ul>
<li>只负责 UI 的呈现，不带有任何业务逻辑</li>
<li>没有状态（即不使用<code>this.state</code>这个变量）</li>
<li>所有数据都由参数（<code>this.props</code>）提供</li>
<li>不使用任何 Redux 的 API</li>
</ul>
<pre><code class="react">const Title =
  value =&gt; &lt;h1&gt;{value}&lt;/h1&gt;;
</code></pre>
<p>因为不含有状态，UI 组件又称为”纯组件”，即它纯函数一样，纯粹由参数决定它的值。</p>
<h4 id="二、容器组件"><a href="#二、容器组件" class="headerlink" title="二、容器组件"></a>二、容器组件</h4><p>容器组件的特征恰恰相反。</p>
<ul>
<li>负责管理数据和业务逻辑，不负责 UI 的呈现</li>
<li>带有内部状态</li>
<li>使用 Redux 的 API</li>
</ul>
<p>总之，只要记住一句话就可以了：UI 组件负责 UI 的呈现，容器组件负责管理数据和逻辑。</p>
<p>如果一个组件既有 UI 又有业务逻辑，将它拆分成下面的结构：外面是一个容器组件，里面包了一个UI 组件。前者负责与外部的通信，将数据传给后者，由后者渲染出视图。</p>
<p>React-Redux 规定，所有的 UI 组件都由用户提供，容器组件则是由 React-Redux 自动生成。也就是说，用户负责视觉层，状态管理则是全部交给它。</p>
<h4 id="三、connect"><a href="#三、connect" class="headerlink" title="三、connect()"></a>三、connect()</h4><p>React-Redux 提供<code>connect</code>方法，用于从 UI 组件生成容器组件。<code>connect</code>的意思，就是将这两种组件连起来。</p>
<pre><code class="react">import { connect } from &#39;react-redux&#39;
const VisibleTodoList = connect()(TodoList);
</code></pre>
<p>因为没有定义业务逻辑，上面这个容器组件毫无意义。为了定义业务逻辑，需要给出下面两方面的信息。</p>
<blockquote>
<p>（1）输入逻辑：外部的数据（即<code>state</code>对象）如何转换为 UI 组件的参数</p>
<p>（2）输出逻辑：用户发出的动作如何变为 Action 对象，从 UI 组件传出去。</p>
</blockquote>
<p><code>connect</code>方法的完整 API 如下。</p>
<pre><code class="react">import { connect } from &#39;react-redux&#39;

const VisibleTodoList = connect(
  mapStateToProps,
  mapDispatchToProps
)(TodoList)
</code></pre>
<p><code>connect</code>方法接受两个参数：<code>mapStateToProps</code>和<code>mapDispatchToProps</code>。它们定义了 UI 组件的业务逻辑。前者负责输入逻辑，即将<code>state</code>映射到 UI 组件的参数（<code>props</code>），后者负责输出逻辑，即将用户对 UI 组件的操作映射成 Action。</p>
<h4 id="四、mapStateToProps"><a href="#四、mapStateToProps" class="headerlink" title="四、mapStateToProps()"></a>四、mapStateToProps()</h4><p>它的作用就是像它的名字那样，建立一个从（外部的）<code>state</code>对象到（UI 组件的）<code>props</code>对象的映射关系。</p>
<p>作为函数，<code>mapStateToProps</code>执行后应该返回一个对象，里面的每一个键值对就是一个映射。</p>
<pre><code class="react">const mapStateToProps = (state) =&gt; {
  return {
    todos: getVisibleTodos(state.todos, state.visibilityFilter)
  }
}
</code></pre>
<p>面代码中，<code>mapStateToProps</code>是一个函数，它接受<code>state</code>作为参数，返回一个对象。这个对象有一个<code>todos</code>属性，代表 UI 组件的同名参数，后面的<code>getVisibleTodos</code>也是一个函数，可以从<code>state</code>算出 <code>todos</code> 的值。</p>
<p><code>mapStateToProps</code>会订阅 Store，每当<code>state</code>更新的时候，就会自动执行，重新计算 UI 组件的参数，从而触发 UI 组件的重新渲染。</p>
<p><code>mapStateToProps</code>的第一个参数总是<code>state</code>对象，还可以使用第二个参数，代表容器组件的<code>props</code>对象。</p>
<pre><code class="react">// 容器组件的代码
//    &lt;FilterLink filter=&quot;SHOW_ALL&quot;&gt;
//      All
//    &lt;/FilterLink&gt;

const mapStateToProps = (state, ownProps) =&gt; {
  return {
    active: ownProps.filter === state.visibilityFilter
  }
}
</code></pre>
<p>使用<code>ownProps</code>作为参数后，如果容器组件的参数发生变化，也会引发 UI 组件重新渲染。</p>
<p><code>connect</code>方法可以省略<code>mapStateToProps</code>参数，那样的话，UI 组件就不会订阅Store，就是说 Store 的更新不会引起 UI 组件的更新。</p>
<h4 id="五、mapDispatchToProps"><a href="#五、mapDispatchToProps" class="headerlink" title="五、mapDispatchToProps()"></a>五、mapDispatchToProps()</h4><p><code>mapDispatchToProps</code>是用来建立 UI 组件的参数到<code>store.dispatch</code>方法的映射。也就是说，它定义了哪些用户的操作应该当作 Action，传给 Store。它可以是一个函数，也可以是一个对象。</p>
<p>如果<code>mapDispatchToProps</code>是一个函数，会得到<code>dispatch</code>和<code>ownProps</code>（容器组件的<code>props</code>对象）两个参数。</p>
<pre><code class="react">const mapDispatchToProps = (
  dispatch,
  ownProps
) =&gt; {
  return {
    onClick: () =&gt; {
      dispatch({
        type: &#39;SET_VISIBILITY_FILTER&#39;,
        filter: ownProps.filter
      });
    }
  };
}
</code></pre>
<p>从上面代码可以看到，<code>mapDispatchToProps</code>作为函数，应该返回一个对象，该对象的每个键值对都是一个映射，定义了 UI 组件的参数怎样发出 Action。</p>
<p>如果<code>mapDispatchToProps</code>是一个对象，它的每个键名也是对应 UI 组件的同名参数，键值应该是一个函数，会被当作 Action creator ，返回的 Action 会由 Redux 自动发出。举例来说</p>
<pre><code class="react">const mapDispatchToProps = {
  onClick: (filter) =&gt; {
    type: &#39;SET_VISIBILITY_FILTER&#39;,
    filter: filter
  };
}
</code></pre>
<h4 id="六、-lt-Provider-gt-组件"><a href="#六、-lt-Provider-gt-组件" class="headerlink" title="六、&lt;Provider&gt; 组件"></a>六、<code>&lt;Provider&gt;</code> 组件</h4><p><code>connect</code>方法生成容器组件以后，需要让容器组件拿到<code>state</code>对象，才能生成 UI 组件的参数。</p>
<p>一种解决方法是将<code>state</code>对象作为参数，传入容器组件。但是，这样做比较麻烦，尤其是容器组件可能在很深的层级，一级级将<code>state</code>传下去就很麻烦。</p>
<p>React-Redux 提供<code>Provider</code>组件，可以让容器组件拿到<code>state</code>。</p>
<pre><code class="react">import { Provider } from &#39;react-redux&#39;
import { createStore } from &#39;redux&#39;
import todoApp from &#39;./reducers&#39;
import App from &#39;./components/App&#39;

let store = createStore(todoApp);

render(
  &lt;Provider store={store}&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;,
  document.getElementById(&#39;root&#39;)
)
</code></pre>
<p><code>Provider</code>在根组件外面包了一层，这样一来，<code>App</code>的所有子组件就默认都可以拿到<code>state</code>了。它的原理是<code>React</code>组件的<a href="https://facebook.github.io/react/docs/context.html" target="_blank" rel="external"><code>context</code></a>属性，请看源码。</p>
<pre><code class="react">class Provider extends Component {
  getChildContext() {
    return {
      store: this.props.store
    };
  }
  render() {
    return this.props.children;
  }
}

Provider.childContextTypes = {
  store: React.PropTypes.object
}
</code></pre>
<p>上面代码中，<code>store</code>放在了上下文对象<code>context</code>上面。然后，子组件就可以从<code>context</code>拿到<code>store</code>，样例代码大致如下。</p>
<pre><code class="react">class VisibleTodoList extends Component {
  componentDidMount() {
    const { store } = this.context;
  }

  render() {
    const props = this.props;
    const { store } = this.context;
    const state = store.getState();
    // ...
  }
}
</code></pre>
<p><code>React-Redux</code>自动生成的容器组件的代码，就类似上面这样，从而拿到<code>store</code>。</p>
<h4 id="七、实例：计数器-1"><a href="#七、实例：计数器-1" class="headerlink" title="七、实例：计数器"></a>七、实例：计数器</h4><p>一个计数器组件，它是一个纯的 UI 组件。</p>
<pre><code class="react">class Counter extends Component {
  render() {
    const { value, onIncreaseClick } = this.props
    return (
      &lt;div&gt;
        &lt;span&gt;{value}&lt;/span&gt;
        &lt;button onClick={onIncreaseClick}&gt;Increase&lt;/button&gt;
      &lt;/div&gt;
    )
  }
}
</code></pre>
<p>这个 UI 组件有两个参数：<code>value</code>和<code>onIncreaseClick</code>。前者需要从<code>state</code>计算得到，后者需要向外发出 Action。</p>
<p>定义<code>value</code>到<code>state</code>的映射，以及<code>onIncreaseClick</code>到<code>dispatch</code>的映射。</p>
<pre><code class="react">function mapStateToProps(state) {
  return {
    value: state.count
  }
}

function mapDispatchToProps(dispatch) {
  return {
    onIncreaseClick: () =&gt; dispatch(increaseAction)
  }
}

// Action Creator
const increaseAction = { type: &#39;increase&#39; }
</code></pre>
<p>然后，使用<code>connect</code>方法生成容器组件。</p>
<pre><code class="react">const App = connect(
  mapStateToProps,
  mapDispatchToProps
)(Counter)
</code></pre>
<p>定义这个组件的 Reducer</p>
<pre><code class="react">// Reducer
function counter(state = { count: 0 }, action) {
  const count = state.count
  switch (action.type) {
    case &#39;increase&#39;:
      return { count: count + 1 }
    default:
      return state
  }
}
</code></pre>
<p>最后，生成<code>store</code>对象，并使用<code>Provider</code>在根组件外面包一层</p>
<pre><code class="react">
import { loadState, saveState } from &#39;./localStorage&#39;;

const persistedState = loadState();
const store = createStore(
  todoApp,
  persistedState
);

store.subscribe(throttle(() =&gt; {
  saveState({
    todos: store.getState().todos,
  })
}, 1000))

ReactDOM.render(
  &lt;Provider store={store}&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;,
  document.getElementById(&#39;root&#39;)
);
</code></pre>
<p>概括</p>
<pre><code class="react">// 1.React component: 独立
// 2.Action:3 相对独立
// 3.Reducer:2 相对独立
// 4.Store:3
// 5.Map Redux state to component props:1
// 6.Map Redux actions to component props:1,2
// 7.Connected Component:5+6,1
</code></pre>
<h4 id="八、React-Router-路由库"><a href="#八、React-Router-路由库" class="headerlink" title="八、React-Router 路由库"></a>八、React-Router 路由库</h4><p>使用<code>React-Router</code>的项目，与其他项目没有不同之处，也是使用<code>Provider</code>在<code>Router</code>外面包一层，毕竟<code>Provider</code>的唯一功能就是传入<code>store</code>对象。</p>
<pre><code class="react">const Root = ({ store }) =&gt; (
  &lt;Provider store={store}&gt;
    &lt;Router&gt;
      &lt;Route path=&quot;/&quot; component={App} /&gt;
    &lt;/Router&gt;
  &lt;/Provider&gt;
);
</code></pre>

        
                <blockquote style="margin: 2em 0 0;padding: 0.5em 1em;border-left: 3px solid #F44336;background-color: #F5F5F5;list-style: none;">
                    <p><strong>
                         
                            本文采用 <a rel='nofollow noopener' href='https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh' target='_blank'>CC BY-NC-SA 3.0 Unported</a> 协议进行许可，阅读 <a href='/creativecommons.html' target='_blank'>相关说明</a>
                        </strong>
                        <br>
                        <strong>本文链接：</strong><a href="http://janebt.github.io/2018/01/10/前端/框架/React/《阮一峰--Redux 入门教程》笔记/">http://janebt.github.io/2018/01/10/前端/框架/React/《阮一峰--Redux 入门教程》笔记/</a>
                    </p>
                </blockquote>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 gitcoment -->
<div id="gitment-comment">
    <!-- Gitment 评论框 -->
<div id="container"></div>
</div>
<style>
    #gitment-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    var gitment = new Gitment({
        //id: '页面 ID', // 可选。默认为 location.href
        owner: 'janebt',
        repo: 'janebt.github.io',
        oauth: {
            client_id: 'adee389eb98ad460b2c7',
            client_secret: '60592360bda99443a993f57ce1c3635f79fdbc65',
        },
    })
    gitment.render('container')
</script>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/01/20/项目/IPC项目Websocketd服务器总结/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/01/01/面试/前端/面试重点之AJAX/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(http://t1.aixinxi.net/o_1c1dbu9jefl61vl9141amt1vfba.jpg-w.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="jane's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        janebtgithub@163.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto:janebtgithub@163.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2117/11/">十一月 2117<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">apps</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/基础/">基础<span class="sidebar_archives-count">23</span></a></li><li><a class="sidebar_archives-link" href="/categories/工具/">工具<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/构建/">构建<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/框架/">框架<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/生活/">生活<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/面试/">面试<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/categories/项目/">项目<span class="sidebar_archives-count">3</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags.html" title="标签">
                
                    <i class="material-icons sidebar-material-icons">bookmark</i>
                
                标签
            </a>
        </li>
        
    
        <li>
            <a href="/timeline.html" title="时间线">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                时间线
            </a>
        </li>
        
            <li class="divider"></li>
        
    
        <li>
            <a href="/gallery.html" title="映像">
                
                    <i class="material-icons sidebar-material-icons">photo</i>
                
                映像
            </a>
        </li>
        
    
        <li>
            <a href="/links.html" title="链接">
                
                    <i class="material-icons sidebar-material-icons">people</i>
                
                链接
            </a>
        </li>
        
            <li class="divider"></li>
        
    
        <li>
            <a href="/resume.html" title="简历">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                简历
            </a>
        </li>
        
    
        <li>
            <a href="/about.html" title="关于">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">48</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/janebt" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/bai-yan-zhi-ji/activities" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-zhihu">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Jane's blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>





    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('3gXS00IaaGNfNPMhlV73UmeJ-gzGzoHsz', 'b3xbjqdGWcfsqeXEHw5yT3vx');
    </script>
    <script type="text/ls-javascript" id="leancloud-views-script">
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>






   <!-- Gitment -->





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
